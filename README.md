# CoinFS (coinfs)

**CoinFS** is a NodeJS library for storing files in Bitcoin transactions.  Files upto **40960 bytes** can be encoded and decoded with this library.  Both Bitcoin and Testnet networks are supported.

# How it works
During encoding, the file is broken down into 20-byte chunks, each encoded as an address, and added as an output on the transaction, with a value of 2730 satoshis.  This is the current minimum output, or the 'dust threshold'.  This value can also be specified with the **options.dust** property, if needed.  Two more outputs are required, one containing meta data, and one containing the change address.

## Usage
The cost of a CoinFS transaction is roughly the sum of its outputs (N+1 20-byte chunks of data x 2730 satoshis) plus the transaction fee (50000 satoshis per 1000 bytes of transaction).  One or more outputs of previous transactions are the inputs of our new CoinFS transaction.  If the value of one input covers the transaction, then we could use the **estimateCost()** function like this:

```javascript
var coinfs = require('coinfs')

var options = {
  network: 'bitcoin', // [bitcoin|testnet]
  inputs: 1
}

coinfs.estimateCost('./file.txt', options, function(err, cost) {
  console.log(cost)
})
```

Sometimes, we need to combine several outputs because no single output carries the whole amount.  This will affect the transaction size, making it a little bit more expensive, around 9000 satoshis per input.

Knowing the number of inputs for the transaction is often not possible, so then you'll have to take a guess.  Over-estimating it should not be a problem, since the excess funds will be sendt back to the change address.

### Encoding
The **encode()** function creates a raw transaction, in form of a string containing hexadecimal data.  This string can be pushed onto the Bitcoin network using software like [Bitcoin Core](https://bitcoin.org/en/bitcoin-core/), or an online service like [Blockcyper](https://live.blockcypher.com).  The inputs property in the options object takes an array of objects pointing to unspent outputs of earlier transactions.

```javascript
var coinfs = require('coinfs')

var options = {
  network: 'bitcoin',                   // [bitcoin|testnet]
  inputs: [{
    hash: 'a5b8da60259ad3a800....',     // TX hash,
    index: 1,                           // Index of TX output
    amount: 50000000,            		// Satoshis in TX output,
    WIF: '5J115WhqnVmZuD1xe4jc1g...'    // Private key of output address
  }],
  changeAddress: '1E8cEJRy38LC4sv8P...' // Bitcoin address to send the change to
}

coinfs.encode('./file.txt', options, function(err, transaction) {
  console.log(transaction.toHex())
})
```

### Decoding
The **decode()** function takes a raw transaction as input, and extracts the data to a buffer.  The transaction must be one generated using the **encode()** function.

```javascript
var coinfs = require('coinfs')

var options = {
  network: 'bitcoin' // [bitcoin|testnet]
}

coinfs.decode(rawTransaction, options, function (err, data) {
  console.log(data.toString())
})
```

**WARNING!!!** - Use this library at your own risk!  You should ***always*** verify the raw transactions before pushing them onto the network.  Funds sent to Bitcoin addresses generated by this library are lost!  At the time of writing, you will be set back 0.2 cents for every Bitcoin address generated.
